<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>Blog Post - Ross Estate Law</title>
	<link rel="stylesheet" type="text/css" href="css/style.css">
	<script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
	<style>
		/* Navigation menu styling */
		#navigation div ul li a {
			font-size: 28px !important;
		}

		/* Blog Post Container */
		.blog-post-full {
			max-width: 900px;
			margin: 40px auto;
			padding: 40px;
			background: white;
			border-radius: 12px;
			box-shadow: 0 4px 20px rgba(0,0,0,0.15);
		}

		.blog-post-full h1 {
			color: #2c2c2c;
			font-size: 42px;
			font-weight: bold;
			margin: 0 0 15px 0;
			line-height: 1.3;
		}

		.blog-post-full .date {
			color: #8ab4a8;
			font-size: 16px;
			font-weight: 600;
			margin-bottom: 30px;
			display: block;
			text-transform: uppercase;
			letter-spacing: 0.5px;
		}

		.blog-post-full .featured-image {
			width: 100%;
			height: auto;
			border-radius: 8px;
			margin: 0 0 30px 0;
			display: block;
		}

		.blog-post-full .content {
			color: #333;
			font-size: 20px;
			line-height: 1.8;
		}

		.blog-post-full .content p {
			margin-bottom: 20px;
			color: #333;
		}

		.blog-post-full .content p:last-child {
			margin-bottom: 0;
		}

		.back-link {
			display: inline-block;
			margin: 20px 0;
			color: #8ab4a8;
			text-decoration: none;
			font-size: 18px;
			font-weight: 600;
		}

		.back-link:hover {
			color: #6b9d8f;
		}

		#loading {
			text-align: center;
			color: white;
			font-size: 20px;
			padding: 100px 20px;
		}
	</style>
</head>
<body>
	<div id="header">
		<div>
			<a href="index.html" class="logo">Ross Estate Law</a>
		</div>
	</div>
	<div id="navigation">
		<div>
			<ul>
				<li>
					<a class="home" href="index.html">Home</a>
				</li>
				<li class="dropdown">
					<a class="about" href="about.html">About</a>
					<div class="dropdown-content">
						<a href="about.html">Dr. Megan Ross</a>
						<a href="our-process.html">Our Process</a>
					</div>
				</li>
				<li class="dropdown">
					<a class="services" href="estate-planning.html">Services</a>
					<div class="dropdown-content services-dropdown">
						<a href="estate-planning.html">Estate Planning</a>
						<a href="young-families.html">Estate Planning for Young Families</a>
						<a href="probate-services.html">Executor and Probate Services</a>
						<a href="legal-transition.html">Legal Transition Services</a>
					</div>
				</li>
				<li class="current">
					<a class="blog" href="blog.html">Blog</a>
				</li>
			</ul>
		</div>
	</div>
	<div id="body">
		<div id="loading">Loading blog post...</div>
		<div id="blog-post-container"></div>
	</div>
	<div class="contact-banner">
		<div class="contact-content">
			<div class="contact-info">
				<h2>Ross Estate Law</h2>
				<div class="contact-details">
					<div class="contact-item">
						<span class="phone">(902) 403-0008</span>
					</div>
					<div class="contact-item">
						<span class="email">megan@rossestatelaw.ca</span>
					</div>
					<div class="contact-item">
						<span class="address">99 Wyse Road, Suite 1100<br>Dartmouth, Nova Scotia<br>B3A 4S5</span>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div id="footer">
		<ul>
			<li>
				<a href="index.html">Home</a>
			</li>
			<li>
				<a href="about.html">About</a>
			</li>
			<li>
				<a href="estate-planning.html">Services</a>
			</li>
			<li>
				<a href="blog.html">Blog</a>
			</li>
		</ul>
	</div>

	<script>
		// Get post slug from URL
		function getPostSlug() {
			const params = new URLSearchParams(window.location.search);
			return params.get('post');
		}

		// Load and display blog post
		async function loadBlogPost() {
			const slug = getPostSlug();

			if (!slug) {
				document.getElementById('loading').innerHTML = '<p>Blog post not found.</p><a href="blog.html" class="back-link">← Back to Blog</a>';
				return;
			}

			try {
				// Fetch the specific post from GitHub
				const filename = slug + '.md';
				const response = await fetch(`https://api.github.com/repos/theRealSlickFrog/Megan-Ross/contents/_posts/${filename}`);

				if (!response.ok) {
					throw new Error('Post not found');
				}

				const fileData = await response.json();
				const contentResponse = await fetch(fileData.download_url);
				const content = await contentResponse.text();

				const post = parseMarkdownPost(content);

				if (!post) {
					throw new Error('Could not parse post');
				}

				// Update page title
				document.title = `${post.title} - Ross Estate Law`;

				// Display the post
				document.getElementById('loading').style.display = 'none';
				document.getElementById('blog-post-container').innerHTML = `
					<div class="blog-post-full">
						<a href="blog.html" class="back-link">← Back to All Posts</a>
						<h1>${escapeHtml(post.title)}</h1>
						<div class="date">${new Date(post.date).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}</div>
						${post.thumbnail ? `<img src="${post.thumbnail}" alt="${escapeHtml(post.title)}" class="featured-image">` : ''}
						<div class="content">${markdownToHtml(post.body)}</div>
						<a href="blog.html" class="back-link">← Back to All Posts</a>
					</div>
				`;

			} catch (error) {
				console.error('Error loading blog post:', error);
				document.getElementById('loading').innerHTML = '<p>Blog post not found.</p><a href="blog.html" class="back-link">← Back to Blog</a>';
			}
		}

		// Parse markdown post file
		function parseMarkdownPost(content) {
			const frontMatterRegex = /^---\s*\n([\s\S]*?)\n---\s*\n([\s\S]*)$/;
			const match = content.match(frontMatterRegex);

			if (!match) return null;

			const frontMatter = match[1];
			const body = match[2];

			const post = { body };

			// Parse front matter
			frontMatter.split('\n').forEach(line => {
				const [key, ...valueParts] = line.split(':');
				if (key && valueParts.length) {
					const value = valueParts.join(':').trim();
					post[key.trim()] = value;
				}
			});

			return post;
		}

		// Simple markdown to HTML converter
		function markdownToHtml(markdown) {
			if (!markdown || markdown.trim() === '') return '<p>No content</p>';

			// Split by double newlines for paragraphs, or single newlines if no double newlines
			const paragraphs = markdown.includes('\n\n')
				? markdown.split('\n\n')
				: markdown.split('\n');

			return paragraphs
				.map(para => para.trim())
				.filter(para => para.length > 0)
				.map(para => {
					// Replace single line breaks with <br>
					const formatted = para.replace(/\n/g, '<br>');
					return `<p>${escapeHtml(formatted)}</p>`;
				})
				.join('');
		}

		// Escape HTML to prevent XSS
		function escapeHtml(text) {
			const div = document.createElement('div');
			div.textContent = text;
			return div.innerHTML;
		}

		// Load post when page loads
		document.addEventListener('DOMContentLoaded', loadBlogPost);
	</script>

</body>
</html>
