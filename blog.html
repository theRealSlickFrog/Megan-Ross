<!DOCTYPE html>
<!-- Website template by freewebsitetemplates.com -->
<html>
<head>
	<meta charset="UTF-8">
	<title>Blog - Ross Estate Law</title>
	<link rel="stylesheet" type="text/css" href="css/style.css">
	<script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
	<style>
		/* Navigation menu styling */
		#navigation div ul li a {
			font-size: 28px !important;
		}
	</style>
</head>
<body class="blog-page">
	<div id="header">
		<div>
			<a href="index.html" class="logo">Ross Estate Law</a>
		</div>
	</div>
	<div id="navigation">
		<div>
			<ul>
				<li>
					<a class="home" href="index.html">Home</a>
				</li>
				<li class="dropdown">
					<a class="about" href="about.html">About</a>
					<div class="dropdown-content">
						<a href="about.html">Dr. Megan Ross</a>
						<a href="our-process.html">Our Process</a>
					</div>
				</li>
				<li class="dropdown">
					<a class="services" href="estate-planning.html">Services</a>
					<div class="dropdown-content services-dropdown">
						<a href="estate-planning.html">Estate Planning</a>
						<a href="young-families.html">Estate Planning for Young Families</a>
						<a href="probate-services.html">Executor and Probate Services</a>
						<a href="legal-transition.html">Legal Transition Services</a>
					</div>
				</li>
				<li class="current">
					<a class="blog" href="blog.html">Blog</a>
				</li>
			</ul>
		</div>
	</div>
	<div id="body">
		<div id="background">
			<div>
				<div>
					<div>
						<h1>LEGAL INSIGHTS<br>& UPDATES</h1>
						<p>
							Professional legal information and estate planning insights.
						</p>
					</div>
				</div>
			</div>
		</div>
		<div id="content-section">
			<div class="blog-header">
				<h2>BLOG POSTS</h2>
				<hr>
				<div id="blog-posts">
					<p style="text-align: center; margin: 40px 0;">Loading blog posts...</p>
				</div>
				<p style="text-align: center; margin: 20px 0; color: #999;">
					<a href="/admin" style="color: #8ab4a8; text-decoration: underline;">Access Admin Panel</a> to create new blog posts.
				</p>
			</div>
		</div>
	</div>
	<div class="contact-banner">
		<div class="contact-content">
			<div class="contact-info">
				<h2>Ross Estate Law</h2>
				<div class="contact-details">
					<div class="contact-item">
						<span class="phone">(902) 403-0008</span>
					</div>
					<div class="contact-item">
						<span class="email">megan@rossestatelaw.ca</span>
					</div>
					<div class="contact-item">
						<span class="address">99 Wyse Road, Suite 1100<br>Dartmouth, Nova Scotia<br>B3A 4S5</span>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div id="footer">
		<ul>
			<li>
				<a href="index.html">Home</a>
			</li>
			<li>
				<a href="about.html">About</a>
			</li>
			<li>
				<a href="estate-planning.html">Services</a>
			</li>
			<li>
				<a href="blog.html">Blog</a>
			</li>
		</ul>
	</div>

	<script>
		// Fetch and display blog posts
		async function loadBlogPosts() {
			try {
				// Fetch the list of posts from the GitHub API
				const response = await fetch('https://api.github.com/repos/theRealSlickFrog/Megan-Ross/contents/_posts');
				const files = await response.json();

				const blogContainer = document.getElementById('blog-posts');

				if (!files || files.length === 0) {
					blogContainer.innerHTML = '<p style="text-align: center; margin: 40px 0;">No blog posts yet. Create your first post in the admin panel!</p>';
					return;
				}

				// Fetch each post's content
				const posts = [];
				for (const file of files) {
					if (file.name.endsWith('.md')) {
						const contentResponse = await fetch(file.download_url);
						const content = await contentResponse.text();
						posts.push(parseMarkdownPost(content, file.name));
					}
				}

				// Sort by date (newest first)
				posts.sort((a, b) => new Date(b.date) - new Date(a.date));

				// Display posts as previews
				blogContainer.innerHTML = posts.map(post => {
					const firstSentence = getFirstSentence(post.body);
					const slug = post.slug || createSlug(post.title);

					return `
						<a href="blog-post.html?post=${slug}" class="blog-post-preview">
							${post.thumbnail ? `<img src="${post.thumbnail}" alt="${escapeHtml(post.title)}" class="thumbnail">` : ''}
							<div class="post-info">
								<h3>${escapeHtml(post.title)}</h3>
								<div class="excerpt">${firstSentence}</div>
								<div class="date">${new Date(post.date).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}</div>
								<span class="read-more">Read More â†’</span>
							</div>
						</a>
					`;
				}).join('');

			} catch (error) {
				console.error('Error loading blog posts:', error);
				document.getElementById('blog-posts').innerHTML = '<p style="text-align: center; margin: 40px 0;">Error loading blog posts. Please try again later.</p>';
			}
		}

		// Parse markdown post file
		function parseMarkdownPost(content, filename) {
			const frontMatterRegex = /^---\s*\n([\s\S]*?)\n---\s*\n([\s\S]*)$/;
			const match = content.match(frontMatterRegex);

			if (!match) return null;

			const frontMatter = match[1];
			const body = match[2];

			const post = { body, filename };

			// Parse front matter
			frontMatter.split('\n').forEach(line => {
				const [key, ...valueParts] = line.split(':');
				if (key && valueParts.length) {
					const value = valueParts.join(':').trim();
					post[key.trim()] = value;
				}
			});

			// Create slug from filename
			post.slug = filename.replace('.md', '');

			return post;
		}

		// Get first sentence from blog content
		function getFirstSentence(text) {
			if (!text) return '';

			const plainText = text.replace(/[#*_`]/g, '').trim();

			// Find the first sentence (ending with . ! or ?)
			const match = plainText.match(/^[^.!?]+[.!?]/);
			if (match) {
				return match[0].trim();
			}

			// If no sentence ending found, return first 150 characters
			return plainText.substring(0, 150).trim() + '...';
		}

		// Get excerpt from blog content
		function getExcerpt(text, maxLength = 150) {
			if (!text) return '';

			const plainText = text.replace(/[#*_`]/g, '').trim();

			if (plainText.length <= maxLength) {
				return plainText;
			}

			return plainText.substring(0, maxLength).trim() + '...';
		}

		// Create URL-friendly slug from title
		function createSlug(title) {
			return title
				.toLowerCase()
				.replace(/[^a-z0-9]+/g, '-')
				.replace(/^-|-$/g, '');
		}

		// Simple markdown to HTML converter
		function markdownToHtml(markdown) {
			if (!markdown || markdown.trim() === '') return '<p>No content</p>';

			// Split by double newlines for paragraphs, or single newlines if no double newlines
			const paragraphs = markdown.includes('\n\n')
				? markdown.split('\n\n')
				: markdown.split('\n');

			return paragraphs
				.map(para => para.trim())
				.filter(para => para.length > 0)
				.map(para => {
					// Replace single line breaks with <br>
					const formatted = para.replace(/\n/g, '<br>');
					return `<p>${escapeHtml(formatted)}</p>`;
				})
				.join('');
		}

		// Escape HTML to prevent XSS
		function escapeHtml(text) {
			const div = document.createElement('div');
			div.textContent = text;
			return div.innerHTML;
		}

		// Load posts when page loads
		document.addEventListener('DOMContentLoaded', loadBlogPosts);
	</script>

</body>
</html>